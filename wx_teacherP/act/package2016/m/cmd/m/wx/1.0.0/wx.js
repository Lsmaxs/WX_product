define(function(require,exports,module){var a=require("zepto"),b=require("http://res.wx.qq.com/open/js/jweixin-1.0.0.js"),c=require("qt/sha"),d="http://"+location.hostname+"/jxhd/wap/common/getJsTicket",e=location.href.replace(/\#.*$/,"");function f(){return Math.random().toString(36).substr(2,15)}function g(){return parseInt((new Date).getTime()/1e3)+""}function h(a){var b=Object.keys(a);b=b.sort();var c={};b.forEach(function(b){c[b.toLowerCase()]=a[b]});var d="";for(var e in c)d+="&"+e+"="+c[e];return d=d.substr(1)}function i(a,b){var d={jsapi_ticket:a,nonceStr:f(),timestamp:g(),url:b},e=h(d);return d.signature=c.sha1(e),d}b.getJsTicket=function(c){var f={schoolCode:c.schoolCode?c.schoolCode:"",cropId:c.cropId?c.cropId:""};a.post(d,f,function(a){if("001"==a.resultCode){var d=a.cropId,f=a.ticket,g=i(f,e);b.config({debug:!1,appId:d,timestamp:g.timestamp,nonceStr:g.nonceStr,signature:g.signature,jsApiList:c.jsApiList}),b.ready(function(){c.ready&&c.ready()}),b.error(function(a){c.error&&c.error(a)})}})},module.exports=b});