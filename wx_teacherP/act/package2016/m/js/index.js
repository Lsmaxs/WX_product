define(function(require,exports,module){var a={},b=require("jquery"),c=require("qt/util");require("jquery/popup");var d=require("m/wx"),e=window.location.pathname,f=(e.substring(0,e.lastIndexOf("/")),"http://"+location.hostname+":"+(location.port?location.port:"80")),g=c.P("schoolCode"),h=c.P("userId"),i=null,j=0,k=0,l=!1,m=[{pic:"",name:""},{pic:"1",name:"1元爱心基金"},{pic:"5",name:"红包5元"},{pic:"10",name:"红包10元"},{pic:"50",name:"红包50元"},{pic:"100",name:"红包100元"},{pic:"mi",name:"红米Note3"},{pic:"mini",name:"Ipad mini4"}];function n(){return g&&h?(o(),p(),t(),s(),r(),d.getJsTicket({schoolCode:g,jsApiList:["hideOptionMenu","hideAllNonBaseMenuItem","hideMenuItems"],ready:function(){d.hideAllNonBaseMenuItem(),d.hideOptionMenu()},error:function(){}}),void B()):void x({msg:"你不能参与本次活动",callback:function(){}})}function o(){var a={uid:h,schoolCode:g};w(f+"/portal/wap/mkactive/join",a,function(a){if("0001"==a.resultCode){k=1,i=a.activeCode,j=a.times?a.times:0,b("#applyTime").html(""+j);for(var c=new Array,d=0;d<a.awards.length;d++){var e=a.awards[d],f=m[e.index],g=e.username.substring(0,3)+"****"+e.username.substring(7);c.push("<p><span>"+g+'</span><b><img src="./images/Prize_'+f.pic+'.png" />'+f.name+"</b></p>")}b(".marque_list").html(c.join("")),q()}else"0008"==a.resultCode?(k=2,x(a.resultMsg)):x(a.resultMsg)})}function p(){for(var a=[],c=360/7,d=360/14,e=0;7>e;e++)a[e]=d+e*c;var m=new v({id:"roller",speed:3,min:2});b("#applyBtn").on("click",function(){if(0==k)return void x("活动还没开始");if(2==k)return void x("活动已经结束");if(1==k&&!l){if(0>=j)return void x({msg:"本轮抽奖机会已经用完啦。马上分享你最新更新的文章吧！越多人阅读你的文章，就有越多抽奖机会哦~",left:!0});l=!0;var a=b(this);a.removeClass("doudong"),m.play();var c={uid:h,schoolCode:g,activeCode:i};w(f+"/portal/wap/mkactive/lottery",c,function(a){if("0001"==a.resultCode){var d=a.lotteryCode;if(!d)return void x({msg:"领奖服务有问题，本次抽奖无效,请稍后再抽",callback:function(){location.reload()}});c.lotteryCode=d,j=a.lotteryLeaveTime,b("#applyTime").html(""+j),setTimeout(function(){n(c)},1e3)}else l=!1,x(a.resultMsg)})}});function n(c){w(f+"/portal/wap/mkactive/iswon",c,function(d){if("0001"==d.resultCode)if(1==d.isAward){var e=d.exchangeCode;if(1<=d.index&&d.index<=7){var f=d.index%7,g=a[f];m.stop(g,function(){setTimeout(function(){l=!1,u(d.index,e),b("#roller").css({"transition-duration":"0","-webkit-transition-duration":"0"}),b("#roller").css({transform:"rotate(0deg)","-webkit-transform":"rotate(0deg)"}),b("#applyBtn").addClass("doudong")},1e3)})}}else 0==d.isAward&&setTimeout(function(){n(c)},3e3);else l=!1,x(d.resultMsg)})}}function q(){var a=(b(".marque"),b(".marque_list")),c=a.find("p"),d=c.length;if(d>10){var e=.34*d;a.append(a.html());var f=new Array;f.push("<style>"),f.push(".marque_list{"),f.push("	animation:marque 10s linear infinite;"),f.push("	-webkit-animation:marque 10s linear infinite; "),f.push("	animation-fill-mode: forwards;"),f.push("	-webkit-animation-fill-mode: forwards;"),f.push("}"),f.push("@keyframes marque{"),f.push("	0% {transform:translate(0,0)}"),f.push("	100% {transform:translate(0,-"+e+"rem)}"),f.push("}"),f.push("@-webkit-keyframes marque{"),f.push("	0% {-webkit-transform:translate(0,0)}"),f.push("	100% {-webkit-transform:translate(0,-"+e+"rem)}"),f.push("}"),f.push("</style>"),b("head").append(f.join(""))}}function r(){b("#readBtn").on("click",function(){if(!l){l=!0;var a={uid:h,schoolCode:g,activeCode:i};y(),w(f+"/portal/wap/mkactive/activemotion",a,function(a){if(z(),l=!1,"0001"==a.resultCode){for(var c=a.items,d=new Array,e=0;e<c.length;e++){var f=c[e];d.push("<tr><td>"+f.event+'</td><td align="center"><b>'+f.result+"</b></td></tr>")}d.length<=0?(b("#noread").show(),b("#readPage table").hide()):(b("#noread").hide(),b("#readPage table").show()),b("#readPage tbody").html(d.join("")),b("#mainPage").hide(),b("body").css({background:"#fff"}),b("#readPage").fadeIn()}else x(a.resultMsg)})}}),b("#readPage .bt_red1").off().on("click",function(){b("#readPage").hide(),b("body").css({background:"#ffcc42"}),b("#mainPage").fadeIn()})}function s(){b("#recordBtn").on("click",function(){if(0==k)return void x("活动还没开始");if(!l){l=!0;var a={uid:h,schoolCode:g,activeCode:i};y(),w(f+"/portal/wap/mkactive/myawards",a,function(a){if(z(),l=!1,"0001"==a.resultCode){for(var c=a.items,d=new Array,e=0;e<c.length;e++){var f=c[e],g=m[f.index];d.push('<tr><td><img src="./images/Prize_'+g.pic+'.png" />'+g.name+'</td><td align="center"><b>'+(1==f.index?"":f.exchangeCode)+"</b></td></tr>")}d.length<=0?(b("#norecord").show(),b("#recordPage table").hide()):(b("#norecord").hide(),b("#recordPage table").show()),b("#recordPage tbody").html(d.join("")),b("#mainPage,#giftPage").hide(),b("body").css({background:"#fff"}),b("#recordPage").fadeIn()}else x(a.resultMsg)})}}),b("#recordPage .bt_red1").off().on("click",function(){b("#recordPage").hide(),b("body").css({background:"#ffcc42"}),b("#mainPage").fadeIn()})}function t(){b("#ruleBtn").on("click",function(){b("#mainPage").hide(),b("body").css({background:"#fff"}),b("#rulePage").fadeIn()}),b("#rulePage .bt_red1").off().on("click",function(){b("#rulePage").hide(),b("body").css({background:"#ffcc42"}),b("#mainPage").fadeIn()})}function u(a,c){var d="",e="",f=b("#giftPage .Prize_m");1==a?d="埋头苦干，兢兢业业！":2==a?d="春风化雨，润物无声！":3==a?d="默默无闻，孜孜不倦！":4==a?d="文思敏捷，聪明过人！":5==a?d="良师益友，桃李芬芳！":6==a?d="循循善诱，因材施教！":7==a&&(d="身为世范，为人师表！");var g=m[a];7==a||6==a?(e="恭喜你获得<br/>"+g.name+" 一部<br/><b>兑奖口令："+c+"</b>",f.hide(),f=f.eq(0).show()):1==a?(f.hide(),e="恭喜你获得<br/><em>1元爱心基金</em><br/>",f=f.eq(2).show()):(e="恭喜你获得<br/><em>"+g.name+"</em><br/><b>兑奖口令："+c+"</b>",f.hide(),f=f.eq(1).show()),f.find("h1").html(d),f.find("h2").html(e),f.find("img").eq(0).attr("src","./images/jp_"+g.pic+".png"),b("#mainPage").hide(),b("#giftPage").fadeIn(1e3),b("#giftPage .bt_red").off().on("click",function(){b("#recordBtn").trigger("click")})}function v(a){if(a&&a.id){this.options=a,this.roll=b("#"+a.id),this.min=a.min?a.min:2,this.duration=a.duration?a.duration:2,this.timing=a.timing?a.timing:"ease-out",this.playing=!1,this.speed=a.speed?a.speed:3,this.repeat=3,this.cycle=!1,this.cycleAngle=0,this.stopAngle=0,this.stopCallback=null,this.playtime=0;var c=document.createElement("div").style;this._vendor=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],d=0,e=b.length;e>d;d++)if(a=b[d]+"ransform",a in c)return b[d].substr(0,b[d].length-1);return!1}()}}v.prototype={play:function(){if(!this.playing){var a=this;this.playing=!0,this.cycle=!0,this.cycleAngle=0,this.roll.css(this._prefixStyle("transform"),"rotate(0deg)"),setTimeout(function(){a.roll.css(a._prefixStyle("transition-timing-function"),"linear"),a.roll.css(a._prefixStyle("transition-duration"),a.speed+"s"),a.roll.css(a._prefixStyle("transition-property"),"transform"),a.playtime++,a._rollOne()},20)}},_rollOne:function(){var a=this;this.cycleAngle=this.cycleAngle+360*this.repeat,this.roll.on("transitionend",function(){a.roll.off("transitionend"),a.cycle?a._rollOne():a._rollToStop()}).on("webkitTransitionEnd",function(){a.roll.off("webkitTransitionEnd"),a.cycle?a._rollOne():a._rollToStop()}),this.roll.css(this._prefixStyle("transform"),"rotate("+this.cycleAngle+"deg)")},stop:function(a,b){this.stopCallback=b?b:null,this.stopAngle=360*this.min+a;var c=(360*this.min+a)/(360*this.repeat)*this.speed;this.duration=2*c,this.cycle=!1},_rollToStop:function(){var a=this,b=this.stopAngle+this.cycleAngle;this.roll.css(this._prefixStyle("transition-timing-function"),this.timing),this.roll.css(this._prefixStyle("transition-duration"),this.duration+"s"),this.roll.css(this._prefixStyle("transition-property"),"transform"),this.roll.css(this._prefixStyle("transform"),"rotate("+b+"deg)"),this.roll.on("transitionend",function(){a.playing=!1,a.roll.off("transitionend"),a.stopCallback&&a.stopCallback()}).on("webkitTransitionEnd",function(){a.playing=!1,a.roll.off("webkitTransitionEnd"),a.stopCallback&&a.stopCallback()})},_prefixStyle:function(a){return this._vendor===!1?!1:""===this._vendor?a:"-"+this._vendor+"-"+a}};function w(a,c,d){var e={json:JSON.stringify(c)};b.post(a,e,function(a){d&&d(a)})}function x(a){var c={msg:"",callback:null,left:!1};"string"==typeof a?c.msg=a:(c.msg=a.msg,c.callback=a.callback,c.left=a.left),b("#msgBox_msg").css("text-align",c.left?"left":"center").html(c.msg),b("#msgBox .bt_yellow").off().on("click",function(){b("#msgBox").popupClose(),c.callback&&c.callback()}),b("#msgBox").popupOpen()}function y(){b("#loading").show()}function z(){b("#loading").hide()}var A=1;function B(){A--,0>=A&&(b("#loading").hide(),b("#mainPage").show())}n(),module.exports=a});