define(function(require,exports,module){var a={},b=require("jquery");function c(){this.initialize.apply(this,arguments)}c.prototype={initialize:function(a){this.settings={threshold:0,failurelimit:999999,event:"scroll",effect:"show",container:window,srcname:"_src",selector:"img[data-lazy='0']"},a&&(this.settings=b.extend(this.settings,a));this.jqImgs=b(this.settings.selector),this.container=this.settings.container,this.onError=this.settings.onError,this._bindEvent(),this.check()},_bindEvent:function(){var a=this;"scroll"==this.settings.event&&b(this.container).off("scroll.lazy").on("scroll.lazy",function(){a.check()});var c=this.settings.srcname;this.jqImgs.each(function(){var d=this;b(d).off("appear").one("appear",function(){"1"!=b(this).attr("data-lazy")&&b("<img />").on("load",function(){b(d).attr(c)&&b(d).hide().attr("src",b(d).attr(c))[a.settings.effect](a.settings.effectspeed)}).on("error",function(){a.onError&&a.onError.apply(d,[d])}).attr("src",b(d).attr(c)),b(d).attr("data-lazy","1")}),"scroll"!=a.settings.event&&b(d).off(a.settings.event+".lazy").on(a.settings.event+".lazy",function(a){"1"!=b(this).attr("data-lazy")&&b(d).trigger("appear")})})},check:function(){var a=this,c=0;this.jqImgs.each(function(){if(a.abovethetop(this)||a.leftofbegin(this));else if(a.belowthefold(this)||a.rightoffold(this)){if(c++>a.settings.failurelimit)return!1}else b(this).trigger("appear")});var d=b.grep(this.jqImgs,function(a){return"1"!=b(this).attr("data-lazy")});this.jqImgs=b(d)},refresh:function(){this.jqImgs=b(this.settings.selector),this._bindEvent(),this.check()},belowthefold:function(a){if(void 0===this.settings.container||this.settings.container===window)var c=b(window).height()+b(window).scrollTop();else var c=b(this.settings.container).offset().top+b(this.settings.container).height();return c<=b(a).offset().top-this.settings.threshold},rightoffold:function(a){if(void 0===this.settings.container||this.settings.container===window)var c=b(window).width()+b(window).scrollLeft();else var c=b(this.settings.container).offset().left+b(this.settings.container).width();return c<=b(a).offset().left-this.settings.threshold},abovethetop:function(a){if(void 0===this.settings.container||this.settings.container===window)var c=b(window).scrollTop();else var c=b(this.settings.container).offset().top;return c>=b(a).offset().top+this.settings.threshold+b(a).height()},leftofbegin:function(a){if(void 0===this.settings.container||this.settings.container===window)var c=b(window).scrollLeft();else var c=b(this.settings.container).offset().left;return c>=b(a).offset().left+this.settings.threshold+b(a).width()}},a.lazyload=function(a){return new c(a)},module.exports=a});