define(function(require,exports,module){var a={},b=require("jquery"),c=require("qt/util");require("jquery/popup");var d=require("m/wx");require("./stat");var e=window.location.pathname,f=(e.substring(0,e.lastIndexOf("/")),"http://"+location.hostname+":"+(location.port?location.port:"80")),g=c.P("schoolCode"),h=c.P("userId"),i=null,j=0,k=0,l=!1,m=[{pic:"",angle:90,name:"感谢参与"},{pic:"2",angle:135,name:"红包2元"},{pic:"5",angle:180,name:"红包5元"},{pic:"10",angle:225,name:"红包10元"},{pic:"50",angle:270,name:"红包50元"},{pic:"888",angle:315,name:"红包888元"},{pic:"mini",angle:360,name:"Ipad mini4"},{pic:"6splus",angle:405,name:"Apple 6splus"}];function n(){return g&&h?(o(),p(),s(),r(),v(),void D()):void z({msg:"你不能参与本次活动",callback:function(){}})}function o(){var a={uid:h,schoolCode:g};y(f+"/portal/wap/mkactive/join",a,function(a){if("0001"==a.resultCode){k=1,i=a.activeCode,j=a.times?a.times:0,b("#applyTime").html(""+j);for(var c=new Array,d=0;d<a.awards.length;d++){var e=a.awards[d],f=m[e.index],g=e.username.substring(0,3)+"****"+e.username.substring(7);c.push("<p><span>"+g+'</span><b><img src="http://ks3-host-domain/yyhd/cjhd/images/Prize_'+f.pic+'.png" />'+f.name+"</b></p>")}b(".marque_list").html(c.join("")),q()}else"0008"==a.resultCode?(k=2,z(a.resultMsg)):z(a.resultMsg)})}function p(){var a=new u({id:"roller",speed:3,min:2});b("#applyBtn").on("click",function(){if(MtaH5&&MtaH5.clickStat("act_spring2016_index_apply"),0==k)return void z("活动还没开始");if(2==k)return void z("活动已经结束");if(1==k&&!l){if(0>=j)return void z({msg:"您的抽奖机会已经用完啦。"});l=!0;var c=b(this);c.removeClass("doudong"),a.play();var e={uid:h,schoolCode:g,activeCode:i};y(f+"/portal/wap/mkactive/lottery",e,function(a){if("0001"==a.resultCode){var c=a.lotteryCode;if(!c)return void z({msg:"领奖服务有问题，本次抽奖无效,请稍后再抽",callback:function(){location.reload()}});e.lotteryCode=c,j=a.lotteryLeaveTime,b("#applyTime").html(""+j),setTimeout(function(){d(e)},1e3)}else l=!1,z(a.resultMsg)})}});var c=["哎呀，你离奖品仅差0.1厘米。","梦里寻它千百度，抽不出来我不服。","太可惜了你长得太帅，红包被你亮瞎眼了！","颜值太高！奖品看见你太害羞躲一边去了~","据说没抽中的上辈子都是折翼的天使。。。","人生就像一盒巧克力，你永远不知道下一颗是什么味道，说不定下个中奖的就是你！","胜败乃兵家常事，大侠再来一次？","人生贵在“坚持“二字，再来一次，百万好礼等着你！","手一滑，奖品飞走了~","洗个手，我们再抽一次吧~","奖品就在眼前了，继续加油哦！","向流星许个愿，下个中奖的就是你！","失败乃是成功之母哦，继续加油！","阳光总在风雨后，奖品总在你身后，继续加油哦!","天有不测之风云，这次不行，有下次！","曾经有个“特等奖”在你面前没有好好珍惜~没事，重新来一遍！","胜利在后面，不信你再来！","我有强力的预感，下次中奖就是你！","太可惜了，竟然与大奖擦肩而过！","客官，再来一次嘛~"];function d(e){y(f+"/portal/wap/mkactive/iswon",e,function(f){if("0001"==f.resultCode)if(1==f.isAward){var g=f.exchangeCode;if(0<=f.index&&f.index<=7){var h=f.index%8,i=m[h].angle;a.stop(i,function(){setTimeout(function(){if(l=!1,0==f.index){var a=parseInt(1e4*Math.random())%c.length,d=c[a];z(d)}else t(f.index,g);b("#roller").css({"transition-duration":"0s","-webkit-transition-duration":"0s"}),setTimeout(function(){b("#roller").css({transform:"rotate(0deg)","-webkit-transform":"rotate(0deg)"}),b("#applyBtn").addClass("doudong")},300)},1e3)})}}else 0==f.isAward&&setTimeout(function(){d(e)},3e3);else l=!1,z(f.resultMsg)})}}function q(){var a=(b(".marque"),b(".marque_list")),c=a.find("p"),d=c.length;if(d>10){var e=.34*d;a.append(a.html());var f=new Array;f.push("<style>"),f.push(".marque_list{"),f.push("	animation:marque 10s linear infinite;"),f.push("	-webkit-animation:marque 10s linear infinite; "),f.push("	animation-fill-mode: forwards;"),f.push("	-webkit-animation-fill-mode: forwards;"),f.push("}"),f.push("@keyframes marque{"),f.push("	0% {transform:translate(0,0)}"),f.push("	100% {transform:translate(0,-"+e+"rem)}"),f.push("}"),f.push("@-webkit-keyframes marque{"),f.push("	0% {-webkit-transform:translate(0,0)}"),f.push("	100% {-webkit-transform:translate(0,-"+e+"rem)}"),f.push("}"),f.push("</style>"),b("head").append(f.join(""))}}function r(){b("#recordBtn").on("click",function(){if(0==k)return void z("活动还没开始");if(!l){l=!0;var a={uid:h,schoolCode:g,activeCode:i};A(),y(f+"/portal/wap/mkactive/myawards",a,function(a){if(B(),l=!1,"0001"==a.resultCode){for(var c=a.items,d=new Array,e=0;e<c.length;e++){var f=c[e],g=m[f.index];d.push('<tr><td><img src="http://ks3-host-domain/yyhd/cjhd/images/Prize_'+g.pic+'.png" />'+g.name+'</td><td align="center"><b>'+(0==f.index?"":f.exchangeCode)+"</b></td></tr>")}d.length<=0?(b("#norecord").show(),b("#recordPage table").hide(),b("#recordPage .code").hide(),b("#recordPageRule").hide()):(b("#norecord").hide(),b("#recordPage table").show(),b("#recordPage .code").show(),b("#recordPageRule").show()),b("#recordPage tbody").html(d.join("")),location.hash="record"}else z(a.resultMsg)}),location.hash="record"}}),b("#recordPage .bt_red1").off().on("click",function(){history.back()})}function s(){b("#ruleBtn").on("click",function(){location.hash="rule"}),b("#rulePage .bt_red1").off().on("click",function(){history.back()})}function t(a,c,d){var e=b("#giftPage .Prize_m"),f="",g=m[a];7==a||6==a?(f="恭喜你获得<br/>"+g.name+" 一部",e.hide(),e=e.eq(0).show()):(f="恭喜你获得<br/><em>"+g.name+"</em>",e.hide(),e=e.eq(1).show()),e.find("h2").html(f),e.find(".psw").html("兑奖口令："+c),e.find("img").eq(0).attr("src","./images/hj_"+g.pic+".png"),b(window).scrollTop(0),b("#mainPage").hide(),b("body").addClass("bodybg"),b("#giftPage").show(),d&&d(),location.hash="gift",b("#giftPage .bt_box").off().on("click",function(){b("#recordBtn").trigger("click")})}function u(a){if(a&&a.id){this.options=a,this.roll=b("#"+a.id),this.min=a.min?a.min:2,this.duration=a.duration?a.duration:2,this.timing=a.timing?a.timing:"ease-out",this.playing=!1,this.speed=a.speed?a.speed:3,this.repeat=3,this.cycle=!1,this.cycleAngle=0,this.stopAngle=0,this.stopCallback=null,this.playtime=0;var c=document.createElement("div").style;this._vendor=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],d=0,e=b.length;e>d;d++)if(a=b[d]+"ransform",a in c)return b[d].substr(0,b[d].length-1);return!1}()}}u.prototype={play:function(){if(!this.playing){var a=this;this.playing=!0,this.cycle=!0,this.cycleAngle=0,this.roll.css(this._prefixStyle("transform"),"rotate(0deg)"),setTimeout(function(){a.roll.css(a._prefixStyle("transition-timing-function"),"linear"),a.roll.css(a._prefixStyle("transition-duration"),a.speed+"s"),a.roll.css(a._prefixStyle("transition-property"),"transform"),a.playtime++,a._rollOne()},20)}},_rollOne:function(){var a=this;this.cycleAngle=this.cycleAngle+360*this.repeat,this.roll.on("transitionend",function(){a.roll.off("transitionend"),a.cycle?a._rollOne():a._rollToStop()}).on("webkitTransitionEnd",function(){a.roll.off("webkitTransitionEnd"),a.cycle?a._rollOne():a._rollToStop()}),this.roll.css(this._prefixStyle("transform"),"rotate("+this.cycleAngle+"deg)")},stop:function(a,b){this.stopCallback=b?b:null,this.stopAngle=360*this.min+a;var c=(360*this.min+a)/(360*this.repeat)*this.speed;this.duration=2*c,this.cycle=!1},_rollToStop:function(){var a=this,b=this.stopAngle+this.cycleAngle;this.roll.css(this._prefixStyle("transition-timing-function"),this.timing),this.roll.css(this._prefixStyle("transition-duration"),this.duration+"s"),this.roll.css(this._prefixStyle("transition-property"),"transform"),this.roll.css(this._prefixStyle("transform"),"rotate("+b+"deg)"),this.roll.on("transitionend",function(){a.playing=!1,a.roll.off("transitionend"),a.stopCallback&&a.stopCallback()}).on("webkitTransitionEnd",function(){a.playing=!1,a.roll.off("webkitTransitionEnd"),a.stopCallback&&a.stopCallback()})},_prefixStyle:function(a){return this._vendor===!1?!1:""===this._vendor?a:"-"+this._vendor+"-"+a}};function v(){d.getJsTicket({schoolCode:g,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","hideOptionMenu","hideAllNonBaseMenuItem","hideMenuItems"],ready:function(){w()},error:function(a){}})}function w(a){var b=location.href.lastIndexOf("/"),c=location.href.substring(0,b),e=c+"/introduce.html",f="花季送大礼，百万大礼等你拿！",g=c+"/images/share.png",h="春风吹到春花开，百万大礼等你来！";d.onMenuShareTimeline({title:f,link:e,imgUrl:g,success:function(){},cancel:function(){}}),d.onMenuShareAppMessage({title:f,desc:h,link:e,imgUrl:g,success:function(){},cancel:function(){}}),d.onMenuShareQQ({title:f,desc:h,link:e,imgUrl:g,success:function(){},cancel:function(){}}),d.onMenuShareWeibo({title:f,desc:h,link:e,imgUrl:g,success:function(){},cancel:function(){}}),d.hideMenuItems({menuList:["menuItem:copyUrl","menuItem:openWithQQBrowser","menuItem:openWithSafari"]})}function x(){location.hash="main";var a="main";window.onhashchange=function(){var c=location.hash;c=c.replace(/^#/,""),"record"==a&&"gift"==c&&history.back(),"main"==c?(b("#rulePage,#recordPage,#giftPage").hide(),b("#mainPage").fadeIn(),b("body").addClass("bodybg")):"rule"==c?(b("#mainPage").hide(),b("#rulePage").fadeIn(),b("body").removeClass("bodybg")):"record"==c&&(b("#mainPage,#giftPage").hide(),b("#recordPage").fadeIn(),b("body").removeClass("bodybg")),a=c,b(window).scrollTop(0)}}x();function y(a,c,d){var e={json:JSON.stringify(c)};b.post(a,e,function(a){d&&d(a)})}function z(a){var c={msg:"",callback:null,left:!1};"string"==typeof a?c.msg=a:(c.msg=a.msg,c.callback=a.callback,c.left=a.left),b("#msgBox_msg").css("text-align",c.left?"left":"center").html(c.msg),b("#msgBox .bt_yellow,#msgBox .bt_close").off().on("click",function(){b("#msgBox").popupClose(),c.callback&&c.callback()}),b("#msgBox").popupOpen()}function A(){b("#loading").show()}function B(){b("#loading").hide()}var C=1;function D(){C--,0>=C&&(B(),b("#mainPage").show())}n(),module.exports=a});