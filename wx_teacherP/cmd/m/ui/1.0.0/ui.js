define(function(require,exports,module){function a(a){a.id&&(this.container=d("#"+a.id)[0],this.element=this.container.children[0],this.parent=d(this.element),this.slides=this.element.children,this.length=this.slides.length,this.timer=null,this.index=0,this.maxIndex=this.length-1,this.imgWidth=0,this.moving=!1,this.enable=!1,this.config={delay:4e3,speed:1500,direct:"right",easing:"ease",isSwipe:!0,isResize:!0},"object"==typeof a&&(this.config=d.extend(this.config,a)),this.onSlide=this.config.onSlide,this.onShow=this.config.onShow,this.trendLeft=!1,this.reset(),this.length>1&&(this._reg(),this.config.isSwipe&&this._regSwipe(),this.config.isResize&&this._regResize(),this.start()))}function b(a,b){a&&(this.obj=a,this.obj2=null,this.timer=null,this.speed=b||40,this.direction="up",this.e=!1,this.init())}var c={},d=require("zepto");a.prototype={reset:function(){var a=this.container.getBoundingClientRect().width||container.offsetWidth;this.element.style.width=this.length*a+"px",this.element.style.left="0px",this._translate(this.index*-a,0),this.imgWidth=a;for(var b=this.length;b--;){var c=this.slides[b];c.style.width=a+"px",c.setAttribute("data-index",b)}},start:function(){var a=this;this.length<=1||(this.enable=!0,this.trendLeft="right"==this.config.direct?!1:!0,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){"right"==a.config.direct?a._move(a.index,a._circle(a.index+1)):a._move(a.index,a._circle(a.index-1))},a.config.delay))},stop:function(){this.enable=!1,this.timer&&clearTimeout(this.timer)},_translate:function(a,b){var c=this.element.style;c&&(c.webkitTransitionDuration=c.MozTransitionDuration=c.msTransitionDuration=c.OTransitionDuration=c.transitionDuration=b+"ms",c.webkitTransform="translate("+a+"px,0)translateZ(0)",c.msTransform=c.MozTransform=c.OTransform="translateX("+a+"px)")},_move:function(a,b){if(!this.moving){this.moving=!0;var c=this.length*this.imgWidth;this.onSlide&&this.onSlide(b,a),this._from=a,this._to=b,a==this.maxIndex&&0==b&&!1===this.trendLeft?(this.slides[0].style.left=c+"px",this._translate(-c,this.config.speed)):b==this.maxIndex&&0==a&&!0===this.trendLeft?(this.slides[this.maxIndex].style.left=-(this.imgWidth*this.length)+"px",this._translate(this.imgWidth,this.config.speed)):this._translate(-this.imgWidth*b,this.config.speed)}},_over:function(){if(!(this._from<0||this._to<0)){var a=this._from,b=this._to;this._from=this._to=-1,a==this.maxIndex&&0==b&&!1===this.trendLeft?(this.slides[0].style.left="0px",this._translate(0,0)):b==this.maxIndex&&0==a&&!0===this.trendLeft&&(this.slides[this.maxIndex].style.left="0px",this._translate(-(this.imgWidth*this.maxIndex),0)),this.moving=!1,this.index=b,this.onShow&&this.onShow(b),this.enable&&this.start()}},_reg:function(){function a(a){switch(a.type){case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":b._over()}}var b=this;this.element.addEventListener("touchstart",a,!1),this.element.addEventListener("webkitTransitionEnd",a,!1),this.element.addEventListener("msTransitionEnd",a,!1),this.element.addEventListener("oTransitionEnd",a,!1),this.element.addEventListener("otransitionend",a,!1),this.element.addEventListener("transitionend",a,!1)},_regSwipe:function(){function a(){c.timer&&clearTimeout(c.timer),c.trendLeft=!1,c._move(c.index,c._circle(c.index+1))}function b(){c.timer&&clearTimeout(c.timer),c.trendLeft=!0,c._move(c.index,c._circle(c.index-1))}var c=this,d={},e={};this.parent.bind("touchstart",function(a){c.stop();var b=a.targetTouches[0];d={x:b.pageX,y:b.pageY}}),this.parent.bind("touchend",function(f){var g=f.changedTouches[0];e={x:g.pageX-d.x,y:g.pageY-d.y},Math.abs(e.x)>30?(e.x>0?b(g):a(g),c.enable=!0,f.preventDefault()):c.start()})},_regResize:function(){var a=this;window.addEventListener("resize",function(){a.reset()},!1)},_circle:function(a){return a>=0&&a<=this.maxIndex?a:(a+this.length)%this.length}},c.swipeImgs=function(b){return new a(b)},b.prototype={init:function(){function a(){c.marquee()}var b,c=this;if("up"===this.direction){if(this.obj.offsetHeight<this.obj.parentNode.offsetHeight)return;this.obj2=this.obj.cloneNode(!0),d(this.obj).after(this.obj2)}b=setInterval(a,c.speed),this.e&&(this.obj.parentNode.onmouseover=function(){clearInterval(b)},this.obj.parentNode.onmouseout=function(){b=setInterval(a,c.speed)})},marquee:function(){var a,b=this.obj.parentNode;this.obj2&&(a=(this.obj2.offsetTop-this.obj.offsetHeight)/2),"up"===this.direction&&(this.obj2.offsetHeight<=b.scrollTop?b.scrollTop=0:b.scrollTop+=1)}},c.marquee=function(a){var c=a?a:{};return new b(document.getElementById(""+c.id).children[0],c.speed)},module.exports=c});