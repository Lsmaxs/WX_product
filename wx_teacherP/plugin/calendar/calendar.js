define(function(require,exports,module){var qt_model={};function _toDate(a,b){var c,d=a.substring(b.indexOf("y"),b.lastIndexOf("y")+1),e=a.substring(b.indexOf("M"),b.lastIndexOf("M")+1),f=a.substring(b.indexOf("d"),b.lastIndexOf("d")+1),g=a.substring(b.indexOf("h"),b.lastIndexOf("h")+1),h=a.substring(b.indexOf("m"),b.lastIndexOf("m")+1),i=a.substring(b.indexOf("s"),b.lastIndexOf("s")+1);return(null==i||""==i||isNaN(i))&&(i=(new Date).getSeconds()),(null==h||""==h||isNaN(h))&&(h=(new Date).getMinutes()),(null==g||""==g||isNaN(g))&&(g=(new Date).getHours()),(null==f||""==f||isNaN(f))&&(f=(new Date).getDate()),(null==e||""==e||isNaN(e))&&(e=(new Date).getMonth()+1),(null==d||""==d||isNaN(d))&&(d=(new Date).getFullYear()),c=new Date(d,e-1,f,g,h,i)}function _format(a,b){var c,d;c={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"w+":"天一二三四五六".charAt(a.getDay()),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()},/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(d in c)new RegExp("("+d+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?c[d]:("00"+c[d]).substr((""+c[d]).length)));return b}var Calendar=function(a,b,c,d){this.beginYear=1950,this.endYear=2050,this.lang=0,this.dateFormatStyle="yyyy-MM-dd hh:mm:ss",this.date=new Date,this.year=this.date.getFullYear(),this.month=this.date.getMonth(),this.day=this.date.getDate(),this.hour=this.date.getHours(),this.minute=this.date.getMinutes(),this.second=this.date.getSeconds(),this.id=this.date.getTime(),this.isFocus=!1,null!=c&&null!=d&&(this.beginYear=c,this.endYear=d),null!=a&&(this.lang=a),null!=b&&(this.dateFormatStyle=b),this.init(),this.dateControl=null,this.panel=this.getElementById("cal_panel"+this.id),this.container=this.getElementById("cal_container"+this.id),this.leftX=0,this.topY=0,this.colors={cur_word:"#FFFFFF",cur_bg:"#AAFF00",sel_bg:"#FFCCCC",sun_word:"#FF0000",sat_word:"#0000FF",td_word_color:"#000000",td_bg_out:"#EFEFEF",td_bg_over:"#FFCC00",tr_word:"#FFFFFF",tr_bg:"#666666",input_border:"#CCCCCC",input_bg:"#EFEFEF"},this.pickMode={second:1,minute:2,hour:3,day:4,month:5,year:6}};Calendar.language={year:[[""],[""]],months:[["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"]],weeks:[["日","一","二","三","四","五"," 六"],["SUN","MON","TUR","WED","THU","FRI","SAT"]],hour:[["时"],["H"]],minute:[["分"],["M"]],second:[["秒"],["S"]],clear:[["清空"],["CLS"]],today:[["今天"],["TODAY"]],pickTxt:[["确定"],["OK"]],close:[["关闭"],["CLOSE"]]},Calendar.prototype.init=function(){var a,b,c=document;a='<div id="cal_panel'+this.id+'" style="position: absolute;display: none;z-index:9999; background-color: #FFFFFF;border: 1px solid #CCCCCC;width:180px;font-size:12px;"></div>',b=c.createElement("div"),b.innerHTML=a,b.id="cal_container"+this.id,b.style.display="none",c.body.appendChild(b)},Calendar.prototype.selectDate=function(a,b,c,d){var e,f,g;this.leftX=null==c?this.leftX:c,this.topY=null==d?this.topY:d,e=new Date,f=e.getFullYear()-50,g=e.getFullYear()+50,this.beginYear=f,this.endYear=g,this.DateMode=this.pickMode.second;var h=b?b:this.dateFormatStyle;h.indexOf("s")<0&&(this.DateMode=this.pickMode.minute),h.indexOf("m")<0&&(this.DateMode=this.pickMode.hour),h.indexOf("h")<0&&(this.DateMode=this.pickMode.day),h.indexOf("d")<0&&(this.DateMode=this.pickMode.month),h.indexOf("M")<0&&(this.DateMode=this.pickMode.year),h.indexOf("y")<0&&(this.DateMode=this.pickMode.second),this.dateFormatStyleOld=this.dateFormatStyle,this.dateFormatStyle=h,this.show(a)},Calendar.prototype.draw=function(){var a,b,c,d,e;for(a=this,b=[],b[b.length]=' <div name="calendarForm" style="margin: 0px;">',b[b.length]='    <table width="100%" border="0" cellpadding="0" cellspacing="1" style="font-size:12px;">',b[b.length]="      <tr>",b[b.length]='        <th align="left" width="1%"><input style="border: 1px solid '+this.colors.input_border+";background-color:"+this.colors.input_bg+";width:16px;height:20px;",this.DateMode>this.pickMode.month&&(b[b.length]="display:none;"),b[b.length]='" name="prevMonth" type="button" id="prevMonth'+this.id+'" value="&lt;" /></th>',b[b.length]='        <th align="center" width="98%" nowrap="nowrap"><select name="calendarYear" id="calendarYear'+this.id+'" style="font-size:12px;width:60px;"></select><select name="calendarMonth" id="calendarMonth'+this.id+'" style="font-size:12px; width:80px;',this.DateMode>this.pickMode.month&&(b[b.length]="display:none;"),b[b.length]='"></select></th>',b[b.length]='        <th align="right" width="1%"><input style="border: 1px solid '+this.colors.input_border+";background-color:"+this.colors.input_bg+";width:16px;height:20px;",this.DateMode>this.pickMode.month&&(b[b.length]="display:none;"),b[b.length]='" name="nextMonth" type="button" id="nextMonth'+this.id+'" value="&gt;" /></th>',b[b.length]="      </tr>",b[b.length]="    </table>",b[b.length]='    <table id="calendarTable'+this.id+'" width="100%" style="border:0px solid #CCCCCC;background-color:#FFFFFF;font-size:12px;',this.DateMode>=this.pickMode.month&&(b[b.length]="display:none;"),b[b.length]='" border="0" cellpadding="3" cellspacing="1">',b[b.length]='      <tr align="center">',c=0;7>c;c++)b[b.length]='      <th style="font-weight:normal;background-color:'+this.colors.tr_bg+";color:"+this.colors.tr_word+';">'+Calendar.language.weeks[this.lang][c]+"</th>";for(b[b.length]="      </tr>",c=0;6>c;c++){for(b[b.length]='    <tr align="center">',d=0;7>d;d++)0==d?b[b.length]=' <td style="cursor:default;color:'+this.colors.sun_word+';"></td>':6==d?b[b.length]=' <td style="cursor:default;color:'+this.colors.sat_word+';"></td>':b[b.length]=' <td style="cursor:default;color:'+this.colors.td_word_color+';"></td>';b[b.length]="    </tr>"}b[b.length]='      <tr style="',this.DateMode>=this.pickMode.day&&(b[b.length]="display:none;"),b[b.length]='"><td align="center" colspan="7">',b[b.length]='      <select name="calendarHour" id="calendarHour'+this.id+'" style="font-size:12px;"></select>'+Calendar.language.hour[this.lang],b[b.length]='<span style="',this.DateMode>=this.pickMode.hour&&(b[b.length]="display:none;"),b[b.length]='"><select name="calendarMinute" id="calendarMinute'+this.id+'" style="font-size:12px;"></select>'+Calendar.language.minute[this.lang]+"</span>",b[b.length]='<span style="',this.DateMode>=this.pickMode.minute&&(b[b.length]="display:none;"),b[b.length]='"><select name="calendarSecond" id="calendarSecond'+this.id+'" style="font-size:12px;"></select>'+Calendar.language.second[this.lang]+"</span>",b[b.length]="      </td></tr>",b[b.length]="    </table>",b[b.length]='      <div align="center" style="padding:4px 4px 4px 4px;background-color:'+this.colors.input_bg+';">',b[b.length]='        <input name="calendarClear" type="button" id="calendarClear'+this.id+'" value="'+Calendar.language.clear[this.lang]+'" style="border: 1px solid '+this.colors.input_border+";background-color:"+this.colors.input_bg+';width:40px;height:20px;font-size:12px;cursor:pointer;"/>',b[b.length]='        <input name="calendarToday" type="button" id="calendarToday'+this.id+'" value="',b[b.length]=this.DateMode==this.pickMode.day?Calendar.language.today[this.lang]:Calendar.language.pickTxt[this.lang],b[b.length]='" style="border: 1px solid '+this.colors.input_border+";background-color:"+this.colors.input_bg+';width:60px;height:20px;font-size:12px;cursor:pointer"/>',b[b.length]='        <input name="calendarClose" type="button" id="calendarClose'+this.id+'" value="'+Calendar.language.close[this.lang]+'" style="border: 1px solid '+this.colors.input_border+";background-color:"+this.colors.input_bg+';width:40px;height:20px;font-size:12px;cursor:pointer"/>',b[b.length]="      </div>",b[b.length]=" </div>",this.panel.innerHTML=b.join(""),e=this.getElementById("prevMonth"+this.id),e.onclick=function(){a.goPrevMonth()},e.onblur=function(){a.onblur()},this.prevMonth=e,e=this.getElementById("nextMonth"+this.id),e.onclick=function(){a.goNextMonth()},e.onblur=function(){a.onblur()},this.nextMonth=e,e=this.getElementById("calendarClear"+this.id),e.onclick=function(){a.ReturnDate("")},this.calendarClear=e,e=this.getElementById("calendarClose"+this.id),e.onclick=function(){a.hide()},this.calendarClose=e,e=this.getElementById("calendarYear"+this.id),e.onchange=function(){a.update()},e.onblur=function(){a.onblur()},this.calendarYear=e,e=this.getElementById("calendarMonth"+this.id),e.onchange=function(){a.update()},e.onblur=function(){a.onblur()},this.calendarMonth=e,e=this.getElementById("calendarHour"+this.id),e.onchange=function(){a.hour=this.options[this.selectedIndex].value},e.onblur=function(){a.onblur()},this.calendarHour=e,e=this.getElementById("calendarMinute"+this.id),e.onchange=function(){a.minute=this.options[this.selectedIndex].value},e.onblur=function(){a.onblur()},this.calendarMinute=e,e=this.getElementById("calendarSecond"+this.id),e.onchange=function(){a.second=this.options[this.selectedIndex].value},e.onblur=function(){a.onblur()},this.calendarSecond=e,e=this.getElementById("calendarToday"+this.id),e.onclick=function(){var b=a.DateMode!=a.pickMode.day?new Date(a.year,a.month,a.day,a.hour,a.minute,a.second):new Date;a.ReturnDate(_format(b,a.dateFormatStyle))},this.calendarToday=e},Calendar.prototype.bindYear=function(){var a,b,c;for(a=this.calendarYear,a.length=0,b=this.beginYear,c=this.endYear;c>=b;b++)a.options[a.length]=new Option(b+Calendar.language.year[this.lang],b)},Calendar.prototype.bindMonth=function(){var a,b;for(a=this.calendarMonth,a.length=0,b=0;12>b;b++)a.options[a.length]=new Option(Calendar.language.months[this.lang][b],b)},Calendar.prototype.bindHour=function(){var a,b,c;if(a=this.calendarHour,!(a.length>0))for(c=0;24>c;c++)b=("00"+c).substr((""+c).length),a.options[a.length]=new Option(b,b)},Calendar.prototype.bindMinute=function(){var a,b,c;if(a=this.calendarMinute,!(a.length>0))for(c=0;60>c;c++)b=("00"+c).substr((""+c).length),a.options[a.length]=new Option(b,b)},Calendar.prototype.bindSecond=function(){var a,b,c;if(a=this.calendarSecond,!(a.length>0))for(c=0;60>c;c++)b=("00"+c).substr((""+c).length),a.options[a.length]=new Option(b,b)},Calendar.prototype.changeSelect=function(){var a,b,c,d,e;a=this.calendarYear,b=this.calendarMonth,c=this.calendarHour,d=this.calendarMinute,e=this.calendarSecond,a[this.date.getFullYear()-this.beginYear].selected=!0,b[this.date.getMonth()].selected=!0,c[this.hour].selected=!0,d[this.minute].selected=!0,e[this.second].selected=!0},Calendar.prototype.goPrevMonth=function(){(this.year!=this.beginYear||0!=this.month)&&(this.month--,-1==this.month&&(this.year--,this.month=11),this.date=new Date(this.year,this.month,1),this.changeSelect(),this.bindData())},Calendar.prototype.goNextMonth=function(){(this.year!=this.endYear||11!=this.month)&&(this.month++,12==this.month&&(this.year++,this.month=0),this.date=new Date(this.year,this.month,1),this.changeSelect(),this.bindData())},Calendar.prototype.onblur=function(){this.isFocus||this.hide()},Calendar.prototype.ReturnDate=function(a){var b,c;null!=this.dateControl&&(this.dateControl.value=a),this.hide(),null!=this.dateControl.onchange&&(b=this.dateControl.onchange.toString(),b=b.substring(b.indexOf("ValidatorOnChange();")>0?b.indexOf("ValidatorOnChange();")+20:b.indexOf("{")+1,b.lastIndexOf("}")),c=new Function(b),this.dateControl.changeEvent=c,this.dateControl.changeEvent())},Calendar.prototype.update=function(){this.year=this.calendarYear.options[this.calendarYear.selectedIndex].value,this.month=this.calendarMonth.options[this.calendarMonth.selectedIndex].value,this.date=new Date(this.year,this.month,1),this.bindData()},Calendar.prototype.bindData=function(){var a,b,c,d,e=this;if(!(this.DateMode>=this.pickMode.month))for(a=this.getMonthViewArray(this.date.getFullYear(),this.date.getMonth()),b=this.getElementById("calendarTable"+this.id).getElementsByTagName("td"),c=0;c<b.length&&(b[c].style.backgroundColor=this.colors.td_bg_out,b[c].onclick=function(){},b[c].onmouseover=function(){},b[c].onmouseout=function(){},!(c>a.length-1));c++)b[c].innerHTML=a[c],"&nbsp;"!=a[c]&&(b[c].bgColorTxt="td_bg_out",d=new Date,b[c].isToday=!1,d.getFullYear()==this.calendarYear.value&&d.getMonth()==this.calendarMonth.value&&d.getDate()==a[c]&&(b[c].style.backgroundColor=this.colors.cur_bg,b[c].bgColorTxt="cur_bg",b[c].isToday=!0),null!=this.dateControl&&(d=_toDate(this.dateControl.value,this.dateFormatStyle),d.getFullYear()==this.date.getFullYear()&&d.getMonth()==this.date.getMonth()&&d.getDate()==a[c]&&(this.selectedDayTD=b[c],b[c].style.backgroundColor=this.colors.sel_bg)),b[c].onclick=function(){e.DateMode==e.pickMode.day?e.ReturnDate(_format(new Date(e.date.getFullYear(),e.date.getMonth(),this.innerHTML),e.dateFormatStyle)):(null!=e.selectedDayTD&&e.selectedDayTD!=this&&(e.selectedDayTD.style.backgroundColor=e.colors[e.selectedDayTD.bgColorTxt]),this.style.backgroundColor=e.colors.sel_bg,e.day=this.innerHTML,e.selectedDayTD=this)},b[c].style.cursor="pointer",b[c].onmouseover=function(){e.selectedDayTD!=this&&(this.style.backgroundColor=e.colors.td_bg_over)},b[c].onmouseout=function(){e.selectedDayTD!=this&&(this.style.backgroundColor=e.colors[this.bgColorTxt])},b[c].onblur=function(){e.onblur()})},Calendar.prototype.getMonthViewArray=function(a,b){var c,d,e,f;for(c=[],d=new Date(a,b,1).getDay(),e=new Date(a,b+1,0).getDate(),f=0;42>f;f++)c[f]="&nbsp;";for(f=0;e>f;f++)c[f+d]=f+1;return c},Calendar.prototype.getElementById=function(id){if("string"!=typeof id||""==id)return null;if(document.getElementById)return document.getElementById(id);if(document.all)return document.all(id);try{return eval(id)}catch(e){return null}},Calendar.prototype.getElementsByTagName=function(a,b){var c=document;return c.getElementsByTagName?c.getElementsByTagName(b):c.all?c.all.tags(b):void 0},Calendar.prototype.getAbsPoint=function(a){var b,c;for(b=a.offsetLeft,c=a.offsetTop;a=a.offsetParent;)b+=a.offsetLeft,c+=a.offsetTop;return{x:b,y:c}},Calendar.prototype.show=function(a,b){var c,d,e,f=this;if(null==a)throw new Error("arguments[0] is necessary");this.dateControl=a,c=new Date,this.date=a.value.length>0?new Date(_toDate(a.value,this.dateFormatStyle)):_toDate(_format(c,this.dateFormatStyle),this.dateFormatStyle),(""==this.panel.innerHTML||this.dateFormatStyleOld!=this.dateFormatStyle)&&(this.draw(),this.bindYear(),this.bindMonth(),this.bindHour(),this.bindMinute(),this.bindSecond()),this.year=this.date.getFullYear(),this.month=this.date.getMonth(),this.day=this.date.getDate(),this.hour=this.date.getHours(),this.minute=this.date.getMinutes(),this.second=this.date.getSeconds(),this.changeSelect(),this.bindData(),null==b&&(b=a),d=this.getAbsPoint(b),this.panel.style.left=d.x+this.leftX+"px",this.panel.style.top=d.y+this.topY+b.offsetHeight+"px",this.panel.style.display="",this.container.style.display="",e=this.getElementById("calendarTable"+this.id).offsetWidth,this.panel.style.width=e+"px",this.calendarYear.style.width=parseInt((e-35)/2,10)+"px",this.calendarMonth.style.width=parseInt((e-35)/2,10)+"px",this.dateControl.isTransEvent||(this.dateControl.isTransEvent=!0,null!=this.dateControl.onblur&&(this.dateControl.blurEvent=this.dateControl.onblur),this.dateControl.onblur=function(){f.onblur(),"function"==typeof this.blurEvent&&this.blurEvent()}),this.container.onmouseover=function(){f.isFocus=!0},this.container.onmouseout=function(){f.isFocus=!1}},Calendar.prototype.hide=function(){this.panel.style.display="none",this.container.style.display="none",this.isFocus=!1},Calendar.prototype.color=function(a){var b;if(a)for(b in a)this.colors[b]=a[b]},qt_model.getCalendar=function(a){var b=a?a:{},c=new Calendar(b.lang,b.dateFormatStyle?b.dateFormatStyle:"yyyy-MM-dd",b.beginYear,b.endYear);return c&&b.color&&c.color(b.color),c};var _options={lang:0,dateFormatStyle:"yyyy-MM-dd",beginYear:1950,endYear:2050},_singleCal=qt_model.getCalendar(_options);qt_model.selectDate=function(a,b){_singleCal.selectDate(a,b)},qt_model.setColor=function(a){_options.color=a,_singleCal=qt_model.getCalendar(_options)},module.exports=qt_model});