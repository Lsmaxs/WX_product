function Music(){this.init()}!function(){var a=[],b=[],c=null;Music.prototype={total:70,pageSize:10,dataUrl:"http://tingapi.ting.baidu.com/v1/restserver/ting?method=baidu.ting.search.common",playerUrl:"http://box.baidu.com/widget/flash/bdspacesong.swf",init:function(){var a=this;domUtils.on($G("J_searchName"),"keyup",function(b){var c=window.event||b;13==c.keyCode&&a.dosearch()}),domUtils.on($G("J_searchBtn"),"click",function(){a.dosearch()})},callback:function(a){var b=this;b.data=a.song_list,setTimeout(function(){$G("J_resultBar").innerHTML=b._renderTemplate(a.song_list)},300)},dosearch:function(){var a=this;c=null;var b=$G("J_searchName").value;return""==utils.trim(b)?!1:(b=encodeURIComponent(b),void a._sent(b))},doselect:function(a){var b=this;"object"==typeof a?c=a:"number"==typeof a&&(c=b.data[a])},onpageclick:function(c){for(var d=0;d<a.length;d++)$G(a[d]).className="pageoff",$G(b[d]).className="paneloff";$G("page"+c).className="pageon",$G("panel"+c).className="panelon"},listenTest:function(a){var b=this,c=$G("J_preview"),d="m-try"==a.className,e=b._getTryingElem();e&&(e.className="m-try",c.innerHTML=""),d&&(a.className="m-trying",c.innerHTML=b._buildMusicHtml(b._getUrl(!0)))},_sent:function(a){var b=this;$G("J_resultBar").innerHTML='<div class="loading"></div>',utils.loadFile(document,{src:b.dataUrl+"&query="+a+"&page_size="+b.total+"&callback=music.callback&.r="+Math.random(),tag:"script",type:"text/javascript",defer:"defer"})},_removeHtml:function(a){var b=/<\s*\/?\s*[^>]*\s*>/gi;return a.replace(b,"")},_getUrl:function(a){var b=this,d="from=tiebasongwidget&url=&name="+encodeURIComponent(b._removeHtml(c.title))+"&artist="+encodeURIComponent(b._removeHtml(c.author))+"&extra="+encodeURIComponent(b._removeHtml(c.album_title))+"&autoPlay="+a+"&loop=true";return b.playerUrl+"?"+d},_getTryingElem:function(){for(var a=$G("J_listPanel").getElementsByTagName("span"),b=0;b<a.length;b++)if("m-trying"==a[b].className)return a[b];return null},_buildMusicHtml:function(a){var b='<embed class="BDE_try_Music" allowfullscreen="false" pluginspage="http://www.macromedia.com/go/getflashplayer"';return b+=' src="'+a+'"',b+=' width="1" height="1" style="position:absolute;left:-2000px;"',b+=' type="application/x-shockwave-flash" wmode="transparent" play="true" loop="false"',b+=' menu="false" allowscriptaccess="never" scale="noborder">'},_byteLength:function(a){return a.replace(/[^\u0000-\u007f]/g,"aa").length},_getMaxText:function(a){var b=this;return a=b._removeHtml(a),b._byteLength(a)>12?a.substring(0,5)+"...":(a||(a="&nbsp;"),a)},_rebuildData:function(a){for(var b,c=this,d=[],e=c.pageSize,f=0;f<a.length;f++)(f+e)%e==0&&(b=[],d.push(b)),b.push(a[f]);return d},_renderTemplate:function(c){var d=this;if(0==c.length)return'<div class="empty">'+lang.emptyTxt+"</div>";c=d._rebuildData(c);var e=[],f=[],g=[];e.push('<div id="J_listPanel" class="listPanel">'),f.push('<div class="page">');for(var h,i=0;h=c[i++];){b.push("panel"+i),a.push("page"+i),1==i?(e.push('<div id="panel'+i+'" class="panelon">'),1!=c.length&&g.push('<div id="page'+i+'" onclick="music.onpageclick('+i+')" class="pageon">'+i+"</div>")):(e.push('<div id="panel'+i+'" class="paneloff">'),g.push('<div id="page'+i+'" onclick="music.onpageclick('+i+')" class="pageoff">'+i+"</div>")),e.push('<div class="m-box">'),e.push('<div class="m-h"><span class="m-t">'+lang.chapter+'</span><span class="m-s">'+lang.singer+'</span><span class="m-z">'+lang.special+'</span><span class="m-try-t">'+lang.listenTest+"</span></div>");for(var j,k=0;j=h[k++];)e.push('<label for="radio-'+i+"-"+k+'" class="m-m">'),e.push('<input type="radio" id="radio-'+i+"-"+k+'" name="musicId" class="m-l" onclick="music.doselect('+(d.pageSize*(i-1)+(k-1))+')"/>'),e.push('<span class="m-t">'+d._getMaxText(j.title)+"</span>"),e.push('<span class="m-s">'+d._getMaxText(j.author)+"</span>"),e.push('<span class="m-z">'+d._getMaxText(j.album_title)+"</span>"),e.push('<span class="m-try" onclick="music.doselect('+(d.pageSize*(i-1)+(k-1))+');music.listenTest(this)"></span>'),e.push("</label>");e.push("</div>"),e.push("</div>")}return g.reverse(),f.push(g.join("")),e.push("</div>"),f.push("</div>"),e.join("")+f.join("")},exec:function(){var a=this;null!=c&&($G("J_preview").innerHTML="",editor.execCommand("music",{url:a._getUrl(!1),width:400,height:95}))}}}();